{% extends 'base.html' %}
{% load static %}

{% block title %}Leaderboard - {{ puzzle_code }}{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/leaderboard.css' %}">
{% endblock %}

{% block content %}
<div class="leaderboard-container">
    <div class="leaderboard-header">
        <h1>Game Results</h1>
        <p>Puzzle Code: <strong>{{ puzzle_code }}</strong></p>
        <p>Status: <strong>{{ puzzle.status|title }}</strong></p>
    </div>

    <div class="leaderboard-content">
        <h2>Final Scores</h2>
        
        <!-- Debug information -->
        <div style="background: #f0f0f0; padding: 10px; margin: 10px 0; font-size: 12px; text-align: left; border-radius: 5px;">
            <strong>Debug Info:</strong><br>
            Puzzle code: {{ puzzle_code }}<br>
            Puzzle exists: {{ puzzle|yesno:"Yes,No" }}<br>
            {% if puzzle %}
                Puzzle status: {{ puzzle.status }}<br>
                Puzzle active: {{ puzzle.is_active|yesno:"Yes,No" }}<br>
            {% endif %}
            Players count: {{ players.count }}<br>
            {% if players.count > 0 %}
                <strong>Players found:</strong><br>
                {% for player in players %}
                    - {{ player.display_name }}: {{ player.points }} points (Active: {{ player.is_active|yesno:"Yes,No" }})<br>
                {% endfor %}
            {% else %}
                <strong>No players found in queryset</strong><br>
            {% endif %}
        </div>
        
        {% if players %}
            <div class="players-ranking">
                {% for player in players %}
                    <div class="player-rank {% if forloop.first %}winner{% endif %}">
                        <div class="rank-number">
                            {% if forloop.first %}
                                üèÜ #{{ forloop.counter }}
                            {% elif forloop.counter == 2 %}
                                ü•à #{{ forloop.counter }}
                            {% elif forloop.counter == 3 %}
                                ü•â #{{ forloop.counter }}
                            {% else %}
                                #{{ forloop.counter }}
                            {% endif %}
                        </div>
                        <div class="player-info">
                            <div class="player-name">{{ player.display_name }}</div>
                            <div class="player-score">{{ player.points }} points</div>
                            {% if player.correct_words.exists %}
                                <div class="words-solved">
                                    Words solved: {{ player.correct_words.count }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% empty %}
                    <p class="no-players">No players in the queryset.</p>
                {% endfor %}
            </div>
        {% else %}
            <p class="no-players">No players found for this game.</p>
        {% endif %}
    </div>

    <div class="leaderboard-actions">
        <a href="{% url 'home' %}" class="btn btn-primary">Play Again</a>
        <button onclick="shareResults()" class="btn btn-secondary">Share Results</button>
    </div>
</div>


<script>
function shareResults() {
    const text = `Check out my crossword game results! Puzzle: {{ puzzle_code }}`;
    if (navigator.share) {
        navigator.share({
            title: 'Crossword Game Results',
            text: text,
            url: window.location.href
        });
    } else {
        // Fallback for browsers that don't support Web Share API
        navigator.clipboard.writeText(text + ' ' + window.location.href);
        alert('Results copied to clipboard!');
    }
}
</script>
{% endblock %}